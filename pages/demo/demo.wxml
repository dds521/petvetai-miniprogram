<!--pages/demo/demo.wxml-->
<view class="container">
  <view class="header">
    <text class="title">通信 Demo</text>
    <text class="subtitle">小程序与后端服务通信示例</text>
  </view>

  <!-- 健康检查模块 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">🔍 服务健康检查</text>
      <button 
        class="btn-check" 
        size="mini" 
        bindtap="checkHealthStatus"
        disabled="{{isCheckingHealth}}"
      >
        <text wx:if="{{isCheckingHealth}}">检查中...</text>
        <text wx:else>检查服务</text>
      </button>
    </view>
    
    <view class="health-card" wx:if="{{healthStatus}}">
      <view class="health-status {{healthStatus.success ? 'success' : 'error'}}">
        <text class="status-icon">{{healthStatus.success ? '✅' : '❌'}}</text>
        <text class="status-text">{{healthStatus.message}}</text>
      </view>
      <view class="health-data" wx:if="{{healthStatus.data}}">
        <text class="data-label">响应数据：</text>
        <text class="data-content">{{JSON.stringify(healthStatus.data)}}</text>
      </view>
    </view>
  </view>

  <!-- 诊断功能模块 -->
  <view class="section">
    <view class="section-header">
      <text class="section-title">🤖 AI 诊断功能</text>
    </view>
    
    <view class="form-card">
      <!-- 宠物ID输入 -->
      <view class="form-item">
        <text class="label">宠物 ID</text>
        <input 
          class="input" 
          type="number" 
          placeholder="请输入宠物ID（示例：1）" 
          value="{{petId}}"
          bindinput="onPetIdInput"
        />
      </view>

      <!-- 症状描述输入 -->
      <view class="form-item">
        <text class="label">症状描述</text>
        <textarea 
          class="textarea" 
          placeholder="请详细描述宠物的症状，例如：狗狗咳嗽、食欲不振等" 
          value="{{symptomDesc}}"
          bindinput="onSymptomInput"
          maxlength="500"
          show-confirm-bar="{{false}}"
        />
        <text class="char-count">{{symptomDesc.length}}/500</text>
      </view>

      <!-- 提交按钮 -->
      <button 
        class="btn-submit {{isDiagnosing ? 'btn-loading' : ''}}" 
        bindtap="submitDiagnosis"
        disabled="{{isDiagnosing || !symptomDesc.trim()}}"
      >
        <text wx:if="{{isDiagnosing}}">诊断中...</text>
        <text wx:else>提交诊断</text>
      </button>
    </view>

    <!-- 诊断结果 -->
    <view class="result-card" wx:if="{{diagnosisResult}}">
      <view class="result-header">
        <text class="result-title">💡 诊断结果</text>
      </view>
      <view class="result-content">
        <view class="result-item">
          <text class="result-label">建议：</text>
          <text class="result-text">{{diagnosisResult.suggestion}}</text>
        </view>
        <view class="result-item" wx:if="{{diagnosisResult.confidence}}">
          <text class="result-label">置信度：</text>
          <text class="result-value">{{(diagnosisResult.confidence * 100).toFixed(0)}}%</text>
        </view>
      </view>
    </view>

    <!-- 错误提示 -->
    <view class="error-card" wx:if="{{diagnosisError}}">
      <text class="error-icon">❌</text>
      <text class="error-text">{{diagnosisError}}</text>
    </view>

    <!-- 清空按钮 -->
    <view class="action-bar" wx:if="{{diagnosisResult || diagnosisError}}">
      <button class="btn-clear" size="mini" bindtap="clearDiagnosis">清空结果</button>
    </view>
  </view>

  <!-- 说明信息 -->
  <view class="info-section">
    <view class="info-title">📝 说明</view>
    <view class="info-item">
      <text class="info-label">• 健康检查：</text>
      <text class="info-text">用于验证后端服务是否可用</text>
    </view>
    <view class="info-item">
      <text class="info-label">• 诊断功能：</text>
      <text class="info-text">展示如何调用后端 API 进行业务处理</text>
    </view>
    <view class="info-item">
      <text class="info-label">• 模块化设计：</text>
      <text class="info-text">API 调用统一在 utils/api.js 中管理</text>
    </view>
  </view>
</view>

