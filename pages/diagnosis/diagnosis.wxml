<!--pages/diagnosis/diagnosis.wxml-->
<view class="container">
  <view class="header">
    <text class="title">AI 症状诊断</text>
    <text class="subtitle">描述您的宠物症状，获取 AI 专业建议</text>
  </view>

  <view class="form-card">
    <!-- 宠物ID输入 -->
    <view class="form-item">
      <text class="label">宠物 ID</text>
      <input 
        class="input" 
        type="number" 
        placeholder="请输入宠物ID（示例：1）" 
        value="{{petId}}"
        bindinput="onPetIdInput"
      />
    </view>

    <!-- 症状描述输入 -->
    <view class="form-item">
      <text class="label">症状描述</text>
      <textarea 
        class="textarea" 
        placeholder="请详细描述宠物的症状，例如：狗狗咳嗽、食欲不振、精神萎靡等" 
        value="{{symptomDesc}}"
        bindinput="onSymptomInput"
        maxlength="500"
        show-confirm-bar="{{false}}"
      />
      <text class="char-count">{{symptomDesc.length}}/500</text>
    </view>

    <!-- 提交按钮 -->
    <button 
      class="btn-submit {{isLoading ? 'btn-loading' : ''}}" 
      bindtap="submitDiagnosis"
      disabled="{{isLoading || !symptomDesc.trim()}}"
    >
      <text wx:if="{{isLoading}}">分析中...</text>
      <text wx:else>获取 AI 诊断</text>
    </button>
  </view>

  <!-- 诊断结果 -->
  <view class="result-card" wx:if="{{diagnosisResult}}">
    <view class="result-header">
      <text class="result-title">💡 AI 诊断建议</text>
      <text class="result-notice">（仅供参考，请咨询专业兽医）</text>
    </view>
    <view class="result-content">
      <text class="result-text">{{diagnosisResult.suggestion}}</text>
      <view class="result-confidence">
        <text class="confidence-label">置信度：</text>
        <text class="confidence-value">{{(diagnosisResult.confidence * 100).toFixed(0)}}%</text>
      </view>
    </view>
  </view>

  <!-- 错误提示 -->
  <view class="error-card" wx:if="{{error}}">
    <text class="error-icon">❌</text>
    <text class="error-text">{{error}}</text>
  </view>

  <!-- 清空按钮 -->
  <view class="action-bar" wx:if="{{diagnosisResult || error}}">
    <button class="btn-clear" bindtap="clearInput">重新诊断</button>
  </view>
</view>


