<!--pages/consult/consult.wxml-->
<view class="page">
  <!-- å¤´éƒ¨ -->
  <view class="header gradient-bg">
    <view class="header-content">
      <view class="header-top">
        <view class="back-btn" bindtap="goBack">
          <text class="back-icon">â†</text>
        </view>
        <view class="header-text">
          <text class="header-title">åœ¨çº¿å’¨è¯¢</text>
          <text class="header-subtitle">ä¸“ä¸šåŒ»ç”Ÿ24å°æ—¶åœ¨çº¿</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view class="messages-scroll" scroll-y scroll-into-view="{{scrollIntoView}}" scroll-with-animation enable-back-to-top show-scrollbar="{{false}}">
    <view class="messages-container">
      <view class="messages-list">
      <view 
        class="message-item {{item.type === 'user' ? 'user-message' : 'ai-message'}}" 
        wx:for="{{messages}}" 
        wx:key="id"
        id="msg-{{item.id}}"
      >
        <view class="message-avatar {{item.type === 'ai' ? 'ai-avatar' : 'user-avatar'}}">
          <text wx:if="{{item.type === 'ai'}}">ğŸ¤–</text>
          <text wx:else>ğŸ‘¤</text>
        </view>
        <view class="message-content {{item.type === 'ai' ? 'ai-content' : 'user-content'}}">
          <text class="message-text">{{item.content}}</text>
          <text class="message-time">{{item.timestamp}}</text>
        </view>
      </view>

      <!-- æ­£åœ¨è¾“å…¥ -->
      <view class="message-item ai-message" wx:if="{{isTyping}}">
        <view class="message-avatar ai-avatar">
          <text>ğŸ¤–</text>
        </view>
        <view class="message-content ai-content typing">
          <view class="typing-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </view>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥æ¡† -->
  <view class="input-container">
    <view class="input-wrapper {{inputFocused ? 'input-wrapper-focus' : ''}}">
      <input 
        class="input-field" 
        placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." 
        value="{{input}}"
        bindinput="onInput"
        confirm-type="send"
        bindconfirm="sendMessage"
        bindfocus="handleInputFocus"
        bindblur="handleInputBlur"
      />
    </view>
    <button class="send-btn" bindtap="sendMessage" disabled="{{!canSend}}">
      <text class="send-icon">â¤</text>
    </button>
  </view>
</view>

